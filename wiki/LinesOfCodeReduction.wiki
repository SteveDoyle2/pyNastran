#summary Summary of project aiming to reduce size of pyNastran codebase

= Introduction =

The current development version of pyNastran has 52k lines of code spanning 222 files. Reducing this by 10% would help tremendously.
One of the ways to achieve this goal in the more extensive usage of Python idioms and Python standard library.


= Preparations =

First part of this project is all about learning. For Python coding standards and coding tips I found these websites particularly interesting:

 * [http://docs.python.org/howto/doanddont.html Idioms and Anti-Idioms in Python]
 * [http://www.python.org/dev/peps/pep-0008/ PEP 8 -- Style Guide for Python Code]
 * [http://www.python.org/dev/peps/pep-0257/ PEP 257 -- Docstring Conventions]
 * [http://ivory.idyll.org/articles/advanced-swc/ Intermediate and Advanced Software Carpentry in Python]
 * [http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html Code Like a Pythonista: Idiomatic Python]
 * [http://www.memonic.com/user/pneff/folder/python/id/1bufp Python Idioms and Efficiency]
 * [http://www.youtube.com/watch?v=o9pEzgHorH0 Stop Writing Classes ]


= Testing =

Most of the time it will be necessary to refactor existing code. Therefore it is especially important to make sure that the changes will not break existing code. This is the place where Python [http://docs.python.org/library/unittest.html unittest] module comes in. For changed code new tests will be written and existing ones will be used extensively.
 

The general idea is to create automatic system that will check the project against different versions of Python after code change.


= Documentation =


Documentation is extremely important in understanding new code. 

== Doxygen ==

pyNastran have very nice documentation, prepared to render in HTML form with [http://www.doxygen.org Doxygen]. In order to better understand class structure of a project it is useful to enable [http://http://www.graphviz.org/ Graphviz] usage (with `HAVE_DOT = YES` in `Doxyfile`). Doxygen can use _dot_ program to generate different graphs:

{{{

CLASS_GRAPH         = YES # direct and indirect inheritance relations for each documented class

COLLABORATION_GRAPH = YES #direct and indirect implementation dependencies for each documented class

INCLUDE_GRAPH       = YES # graph for each documented file showing the direct and indirect include dependencies

CALL_GRAPH          = YES  #dependency graph for every global function or class method

CALLER_GRAPH        = YES #caller dependency graph for every global function or class method

GRAPHICAL_HIERARCHY = YES #doxygen will generate a graphical hierarchy of all classes instead of a textual one

}}}

_*Warning*_ Enabling all of this options makes documentation building significantly longer and documentation itself gets *much* bigger (almost 4GB for revision r1040)


== Sphinx ==

Currently, most of python programs (and Python itself) are documented with a help of [http://sphinx.pocoo.org Sphinx]. Sphinx can generate a lot of different output formats (including latex, pdf and epub) and of course HTML. Some people like better the HTML documentation generated by Sphinx more and consider it more clear. Sphinx uses [http://http://docutils.sourceforge.net/rst.html reStructuredText] (reST) as a markup language. The comparison of most useful keywords in Sphinx  and Doxygen is as follow


|| Doxygen ||  Sphinx ||
|| `@param parameter` || `:param parameter:` ||
|| `@retval` || `:returns:` ||
|| `@raise` || `:raises:` ||
|| `@note` || `.. note::` ||
|| `@warning` || `.. warning::` ||
|| `@deprecated` || `.. deprecated::` ||
|| `@todo` || `.. todo::` ||


To generate HTML documentation using Sphinx it is necessary to go to `docs_sphinx` directory and issue `make html` command. The conversion form Doxygen documentation format will be automatic. Code responsible for it has been added to `conf.py` configuration file and it seems that it works quite well.

== Mathematics with Latex ==

Both Doxygen and Sphinx 'understand' LaTeX code and nicely generate mathematics formulas. *There is one very important note*: you have to remember about escape characters. Every documentation comment in Python is just a string. Therefore Python will understand 

{{{""" \thau """}}}

as

{{{   hau}}}

that is 'TABULATORhau', and not "\thau". The easiest solution is to mark every string containing LaTeX code as a *raw* string: `r""" \thau """`.

= Project code =

New code will be maintained in [http://code.google.com/p/pynastran/source/browse/#svn%2Fbranches%2Flocr_2012 locr_2012] SVN branch.